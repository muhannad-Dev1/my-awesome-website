<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUFEED IT System</title>
    <style>
        :root {
            --brand-purple: #744394; /* Ù„ÙˆÙ† Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠ */
            --brand-grey: #525252;   /* Ù„ÙˆÙ† Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ */
            --bg-light: #f3f4f6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg-light); color: var(--brand-grey); }

        /* Ø§Ù„Ø´Ø¹Ø§Ø± */
        .logo-container { text-align: center; margin-bottom: 2rem; }
        .logo-svg { height: 60px; width: auto; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .login-page { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: white; }
        .login-card { background: white; padding: 3rem; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); width: 100%; max-width: 450px; border-top: 5px solid var(--brand-purple); }
        
        .input-group { margin-bottom: 1.5rem; text-align: right; }
        .input-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--brand-purple); }
        .input-group input, .input-group select, .input-group textarea { width: 100%; padding: 0.85rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; transition: 0.3s; }
        .input-group input:focus { border-color: var(--brand-purple); outline: none; }

        .btn { padding: 0.85rem 1.5rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.3s; font-size: 1rem; }
        .btn-login { width: 100%; background: var(--brand-purple); color: white; }
        .btn-login:hover { background: #5e357a; }
        
        .btn-primary { background: var(--brand-purple); color: white; }
        .btn-danger { background: #ef4444; color: white; font-size: 0.9rem; padding: 0.5rem 1rem; }
        .btn-success { background: #10b981; color: white; }
        .btn-edit { background: #f59e0b; color: white; font-size: 0.9rem; padding: 0.5rem 1rem; }

        .message { padding: 1rem; border-radius: 8px; margin-bottom: 1rem; display: none; text-align: center; }
        .message.error { background: #fee2e2; color: #991b1b; }
        .message.success { background: #d1fae5; color: #065f46; }

        /* Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .app-container { display: none; min-height: 100vh; }
        .app-header { background: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-bottom: 3px solid var(--brand-purple); }
        
        .header-logo { height: 40px; }
        
        .content { max-width: 1200px; margin: 0 auto; padding: 2rem; }

        .nav-bar { display: flex; gap: 0.5rem; background: white; padding: 0.5rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .nav-btn { padding: 0.8rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; background: transparent; font-weight: bold; color: var(--brand-grey); }
        .nav-btn.active { background: var(--brand-purple); color: white; }

        .page-section { display: none; animation: fadeIn 0.3s ease; }
        .page-section.active { display: block; }

        .card { background: white; border-radius: 15px; padding: 2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.03); margin-bottom: 2rem; }
        
        /* Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        .data-table { width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 0.95rem; }
        .data-table th { background: #f8fafc; color: var(--brand-purple); padding: 1rem; text-align: right; border-bottom: 2px solid #e2e8f0; }
        .data-table td { padding: 1rem; border-bottom: 1px solid #eee; vertical-align: middle; }
        .actions-cell { display: flex; gap: 5px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Ø§Ù„Ø´Ø¹Ø§Ø± SVG */
        .logo-svg path { fill: none; stroke: var(--brand-purple); stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }
        .logo-text { fill: var(--brand-grey); font-family: sans-serif; font-weight: bold; letter-spacing: 2px; }
    </style>
</head>
<body>

    <div id="loginPage" class="login-page">
        <div class="logo-container">
            <svg class="logo-svg" viewBox="0 0 200 60" xmlns="images/WhatsApp Image 2025-12-22 at 3.37.15 PM.jpeg" style="width: 220px; height: auto;">
                <path d="M10 10 L40 50 L70 10 M10 10 L40 30 L70 10 M10 10 V40 M70 10 V40" stroke="#744394" fill="none" stroke-width="3"/>
                <text x="85" y="42" font-size="38" class="logo-text">MUFEED</text>
            </svg>
        </div>

        <div class="login-card">
            <h2 style="text-align: center; margin-bottom: 1.5rem; color: var(--brand-grey);">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</h2>
            <div id="loginMsg" class="message"></div>
            <form id="loginFormElement">
                <div class="input-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" id="usernameInput" required placeholder="">
                </div>
                <div class="input-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="passwordInput" required placeholder="">
                </div>
                <button type="submit" class="btn btn-login">Ø¯Ø®ÙˆÙ„</button>
            </form>
        </div>
        <p style="margin-top: 2rem; color: #9ca3af; font-size: 0.9rem;">MUFEED IT Support System v2.0</p>
    </div>

    <div id="mainApplication" class="app-container">
        <div class="app-header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <svg viewBox="0 0 200 60" style="height: 35px;">
                    <path d="M10 10 L40 50 L70 10 M10 10 L40 30 L70 10 M10 10 V40 M70 10 V40" stroke="#744394" fill="none" stroke-width="4"/>
                    <text x="85" y="45" font-size="40" fill="#525252" font-weight="bold" font-family="sans-serif">MUFEED</text>
                </svg>
                <span style="height: 25px; width: 1px; background: #ddd; margin: 0 10px;"></span>
                <h3 style="color: var(--brand-purple);">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</h3>
            </div>
            
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div style="text-align: left;">
                    <div id="displayUsername" style="font-weight: bold;"></div>
                    <div id="displayRole" style="font-size: 0.8rem; color: #6b7280;"></div>
                </div>
                <button onclick="logout()" class="btn btn-danger">Ø®Ø±ÙˆØ¬</button>
            </div>
        </div>

        <div class="content">
            <div class="nav-bar">
                <button class="nav-btn active" onclick="nav('search', this)">ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ</button>
                <button class="nav-btn" onclick="nav('add', this)">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´ÙƒÙ„Ø©</button>
                <button class="nav-btn" onclick="nav('browse', this)">ğŸ“‚ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ©</button>
                <button class="nav-btn" id="adminBtn" onclick="nav('admin', this)" style="display:none;">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
            </div>

            <div id="searchSection" class="page-section active">
                <div class="card">
                    <h2 style="color: var(--brand-purple); margin-bottom: 1rem;">Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h2>
                    <div class="input-group">
                        <input type="text" id="aiInput" placeholder="Ø§Ø´Ø±Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ù‡Ù†Ø§ (Ù…Ø«Ø§Ù„: Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ù„Ø§ ØªØ¹Ù…Ù„ Ø£Ùˆ Ø§Ù„Ù†Øª Ù…Ù‚Ø·ÙˆØ¹)..." style="padding: 1.2rem;">
                    </div>
                    <button class="btn btn-primary" onclick="searchAI()" style="width: 100%;">ØªØ­Ù„ÙŠÙ„ ÙˆØ¨Ø­Ø«</button>
                    <div id="searchResults" style="margin-top: 2rem;"></div>
                </div>
            </div>

            <div id="addSection" class="page-section">
                <div class="card">
                    <h2 style="color: var(--brand-purple); margin-bottom: 1rem;">ØªÙˆØ«ÙŠÙ‚ Ø­Ù„ Ø¬Ø¯ÙŠØ¯</h2>
                    <form id="addIssueForm">
                        <div class="input-group">
                            <label>Ø¹Ù†ÙˆØ§Ù† / ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
                            <input type="text" id="newDesc" required>
                        </div>
                        <div class="input-group">
                            <label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                            <select id="newCat">
                                <option>Domain & AD</option>
                                <option>Network & Internet</option>
                                <option>Hardware & Printers</option>
                                <option>Software & Office</option>
                                <option>Email & Outlook</option>
                                <option>Other</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ù„ (Ø¨Ø§Ù„ØªÙØµÙŠÙ„)</label>
                            <textarea id="newSol" rows="5" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-success">Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                    </form>
                </div>
            </div>

            <div id="browseSection" class="page-section">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h2 style="color: var(--brand-purple);">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ ÙˆØ§Ù„Ø­Ù„ÙˆÙ„</h2>
                        <button onclick="exportToExcel()" class="btn btn-success">ğŸ“Š ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
                    </div>
                    <div id="browseList"></div>
                </div>
            </div>

            <div id="adminSection" class="page-section">
                <div class="card">
                    <h3 style="color: var(--brand-purple); border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 1rem;">ğŸ› ï¸ Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ø§Ù„ØªØµÙ†ÙŠÙ</th>
                                    <th>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</th>
                                    <th>Ø£Ø¶ÙŠÙ Ø¨ÙˆØ§Ø³Ø·Ø©</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="adminIssuesTable"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <h3 style="color: var(--brand-purple); border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 1rem;">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h3>
                    
                    <div style="background: #f9f9f9; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem;">
                        <h4 style="margin-bottom: 1rem;">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h4>
                        <form id="addUserForm" style="display: flex; gap: 10px; align-items: flex-end; flex-wrap: wrap;">
                            <div style="flex: 1;">
                                <label style="font-size: 0.9rem;">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                                <input type="text" id="newUsername" required style="width: 100%; padding: 0.5rem;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 0.9rem;">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                <input type="text" id="newPassword" required style="width: 100%; padding: 0.5rem;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 0.9rem;">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</label>
                                <select id="newRole" style="width: 100%; padding: 0.5rem;">
                                    <option value="user">Ù…ÙˆØ¸Ù (User)</option>
                                    <option value="admin">Ù…Ø¯ÙŠØ± (Admin)</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Ø¥Ø¶Ø§ÙØ©</button>
                        </form>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                <th>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th>
                                <th>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="adminUsersTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ================= Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª =================
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø§Ø¨Ù‚Ø© Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        let usersDB = JSON.parse(localStorage.getItem('mufeedUsers')) || [
            { id: 1, user: 'admin', pass: 'admin123', role: 'admin' },
            { id: 2, user: 'user1', pass: '1234', role: 'user' }
        ];

        let issuesDB = JSON.parse(localStorage.getItem('mufeedIssues')) || [
            { id: 101, cat: 'Domain & AD', desc: 'Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ØºÙ„Ù‚ (Locked Out)', sol: 'Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù„Ù‰ AD ÙˆØ§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙŠÙˆØ²Ø± ÙˆØ§Ø®ØªÙŠØ§Ø± Unlock Account', by: 'admin' },
            { id: 102, cat: 'Hardware', desc: 'Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ù„Ø§ ØªØ³ØªØ¬ÙŠØ¨', sol: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙŠØ¨Ù„ ÙˆØ§Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø®Ø¯Ù…Ø© Print Spooler', by: 'user1' }
        ];

        let currentUser = null;

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸
        function saveData() {
            localStorage.setItem('mufeedUsers', JSON.stringify(usersDB));
            localStorage.setItem('mufeedIssues', JSON.stringify(issuesDB));
        }

        // ================= Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ =================

        document.getElementById('loginFormElement').onsubmit = function(e) {
            e.preventDefault();
            const u = document.getElementById('usernameInput').value.trim();
            const p = document.getElementById('passwordInput').value.trim();
            const msg = document.getElementById('loginMsg');

            const foundUser = usersDB.find(usr => usr.user === u && usr.pass === p);

            if (foundUser) {
                currentUser = foundUser;
                enterSystem();
            } else {
                msg.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
                msg.className = 'message error show';
            }
        };

        function enterSystem() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApplication').style.display = 'block';
            document.getElementById('displayUsername').textContent = currentUser.user;
            document.getElementById('displayRole').textContent = currentUser.role === 'admin' ? 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…' : 'Ø¯Ø¹Ù… ÙÙ†ÙŠ';
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙ‚Ø· Ù„Ù„Ø£Ø¯Ù…Ù†
            if (currentUser.role === 'admin') {
                document.getElementById('adminBtn').style.display = 'block';
            }

            renderBrowse();
        }

        function logout() {
            location.reload();
        }

        // ================= Ø§Ù„ØªÙ†Ù‚Ù„ =================

        function nav(sectionId, btn) {
            document.querySelectorAll('.page-section').forEach(d => d.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(sectionId+'Section').classList.add('active');
            btn.classList.add('active');

            if(sectionId === 'browse') renderBrowse();
            if(sectionId === 'admin') renderAdmin();
        }

        // ================= Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© =================

        // 1. Ø§Ù„Ø¨Ø­Ø«
        function searchAI() {
            const query = document.getElementById('aiInput').value.toLowerCase();
            const container = document.getElementById('searchResults');
            
            if(!query) return;

            const results = issuesDB.filter(item => 
                item.desc.toLowerCase().includes(query) || 
                item.sol.toLowerCase().includes(query) ||
                item.cat.toLowerCase().includes(query)
            );

            if(results.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#888;">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ù„ÙˆÙ„ Ù…Ø´Ø§Ø¨Ù‡Ø©. Ø­Ø§ÙˆÙ„ Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>';
            } else {
                container.innerHTML = results.map(item => `
                    <div style="background:#f9fafb; border-right:4px solid var(--brand-purple); padding:1rem; margin-bottom:1rem; border-radius:8px;">
                        <div style="font-weight:bold; color:var(--brand-purple);">${item.cat}</div>
                        <div style="font-size:1.1rem; margin:5px 0;">${item.desc}</div>
                        <div style="background:white; padding:10px; margin-top:10px; border-radius:6px; border:1px solid #eee;">
                            <strong>Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ù‚ØªØ±Ø­:</strong><br>
                            ${item.sol}
                        </div>
                    </div>
                `).join('');
            }
        }

        // 2. Ø¥Ø¶Ø§ÙØ© Ù…Ø´ÙƒÙ„Ø©
        document.getElementById('addIssueForm').onsubmit = function(e) {
            e.preventDefault();
            const newIssue = {
                id: Date.now(),
                desc: document.getElementById('newDesc').value,
                cat: document.getElementById('newCat').value,
                sol: document.getElementById('newSol').value,
                by: currentUser.user
            };
            issuesDB.push(newIssue);
            saveData();
            alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙˆØ§Ù„Ø­Ù„ Ø¨Ù†Ø¬Ø§Ø­');
            this.reset();
        };

        // 3. Ø§Ù„ØªØµÙØ­
        function renderBrowse() {
            const list = document.getElementById('browseList');
            list.innerHTML = issuesDB.map(item => `
                <div style="background:white; border-bottom:1px solid #eee; padding:1.5rem 0;">
                    <span style="background:#f3e8ff; color:var(--brand-purple); padding:2px 10px; border-radius:20px; font-size:0.8rem;">${item.cat}</span>
                    <h3 style="margin:10px 0;">${item.desc}</h3>
                    <p style="color:#4b5563; white-space:pre-wrap;">${item.sol}</p>
                    <div style="font-size:0.8rem; color:#9ca3af; margin-top:5px;">Ø¨ÙˆØ§Ø³Ø·Ø©: ${item.by}</div>
                </div>
            `).join('');
        }

        // 4. Ø§Ù„ØªØµØ¯ÙŠØ± Ù„Ø¥ÙƒØ³Ù„
        function exportToExcel() {
            // Ø¥Ø¶Ø§ÙØ© BOM Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
            let csvContent = "\uFEFF"; 
            csvContent += "Ø§Ù„Ù…Ø¹Ø±Ù,Ø§Ù„ØªØµÙ†ÙŠÙ,ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©,Ø§Ù„Ø­Ù„,Ø¨ÙˆØ§Ø³Ø·Ø©\n";

            issuesDB.forEach(row => {
                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ø§Ù„ÙÙˆØ§ØµÙ„ Ù„ØªØ¬Ù†Ø¨ ÙƒØ³Ø± Ù…Ù„Ù CSV
                let cleanDesc = row.desc.replace(/,/g, " ");
                let cleanSol = row.sol.replace(/,/g, " - ").replace(/\n/g, " ");
                csvContent += `${row.id},${row.cat},${cleanDesc},${cleanSol},${row.by}\n`;
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "Mufeed_Data_Export.csv";
            link.click();
        }

        // ================= Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… =================

        function renderAdmin() {
            // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„
            const issueTbody = document.getElementById('adminIssuesTable');
            issueTbody.innerHTML = issuesDB.map((item, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${item.cat}</td>
                    <td>${item.desc}</td>
                    <td>${item.by}</td>
                    <td>
                        <button onclick="deleteIssue(${item.id})" class="btn btn-danger">Ø­Ø°Ù</button>
                    </td>
                </tr>
            `).join('');

            // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            const userTbody = document.getElementById('adminUsersTable');
            userTbody.innerHTML = usersDB.map(u => `
                <tr>
                    <td>${u.user}</td>
                    <td>
                        <span style="padding:2px 8px; border-radius:10px; background:${u.role==='admin'?'#fef3c7':'#dbeafe'}; color:${u.role==='admin'?'#92400e':'#1e40af'}">
                            ${u.role}
                        </span>
                    </td>
                    <td>***</td>
                    <td>
                        ${u.user !== 'admin' ? `<button onclick="deleteUser(${u.id})" class="btn btn-danger">Ø­Ø°Ù</button>` : '<small>ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø­Ø°Ù</small>'}
                    </td>
                </tr>
            `).join('');
        }

        // Ø­Ø°Ù Ù…Ø´ÙƒÙ„Ø©
        window.deleteIssue = function(id) {
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ')) {
                issuesDB = issuesDB.filter(i => i.id !== id);
                saveData();
                renderAdmin();
            }
        };

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…
        document.getElementById('addUserForm').onsubmit = function(e) {
            e.preventDefault();
            const u = document.getElementById('newUsername').value;
            const p = document.getElementById('newPassword').value;
            const r = document.getElementById('newRole').value;

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±
            if(usersDB.find(x => x.user === u)) {
                alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹!');
                return;
            }

            usersDB.push({ id: Date.now(), user: u, pass: p, role: r });
            saveData();
            renderAdmin();
            this.reset();
        };

        // Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…
        window.deleteUser = function(id) {
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ Ø³ÙŠØªÙ… Ù…Ù†Ø¹Ù‡ Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„.')) {
                usersDB = usersDB.filter(u => u.id !== id);
                saveData();
                renderAdmin();
            }
        };

    </script>
</body>
</html>
